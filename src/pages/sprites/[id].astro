---
import FrontPageLayout from "../../layouts/FrontPageLayout.astro";
import SpriteViewer from "../../components/SpriteViewer.svelte";

// Get the sprite ID from the URL params
const { id } = Astro.params;

// Pre-fetch sprite data server-side to reduce loading time
let sprite = null;
let fetchError = null;

try {
  if (id) {
    const response = await fetch(`https://cms.sgxp.me/api/sprites/${id}?depth=3`);
    if (response.ok) {
      sprite = await response.json();
    } else {
      fetchError = 'Sprite not found';
    }
  }
} catch (error) {
  fetchError = 'Failed to load sprite';
  console.error('Server-side fetch error:', error);
}
---

<FrontPageLayout title={`Sprite Sheet Viewer`}>
  <div class="sprite-viewer-page-container">
    <div class="flex flex-col items-center justify-start w-full h-screen">
      <SpriteViewer spriteId={id} initialSprite={sprite} initialError={fetchError} client:only="svelte" />
    </div>
  </div>
</FrontPageLayout>